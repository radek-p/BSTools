
/* //////////////////////////////////////////////////// */
/* This file is a part of the BSTools procedure package */
/* written by Przemyslaw Kiciak.                        */
/* //////////////////////////////////////////////////// */

#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include <string.h>

#include <GL/gl.h>
#include <GL/glu.h>
#include <GL/glx.h>

#include "pkvaria.h"
#include "pknum.h"
#include "pkgeom.h"
#include "camera.h"
#include "multibs.h"
#include "bsmesh.h"
#include "bsfile.h"
#include "palm.h"

#define NORMAL_SHADING

/* level of detail selection, must be 1, 2, or 3 */
int palm_lod = 3;

static GLint palm_dlist;
static GLint foot_dlist = 0;

/* ////////////////////////////////////////////////////////////////////////// */
/* palm surface mesh */
static int palm_nv1 = 76;
static int palm_nhe1 = 284;
static int palm_nfac1 = 68;
static BSMvertex palm_mv1[76] =
 {{3,  0},{4,  3},{5,  7},{5, 12},{5, 17},{4, 22},{4, 26},{4, 30},
  {3, 34},{3, 37},{3, 40},{4, 43},{5, 47},{5, 52},{5, 57},{4, 62},
  {4, 66},{4, 70},{3, 74},{3, 77},{4, 80},{4, 84},{4, 88},{4, 92},
  {4, 96},{4,100},{4,104},{4,108},{3,112},{3,115},{3,118},{3,121},
  {4,124},{4,128},{4,132},{4,136},{4,140},{4,144},{4,148},{4,152},
  {3,156},{3,159},{3,162},{3,165},{4,168},{4,172},{4,176},{4,180},
  {4,184},{4,188},{4,192},{4,196},{3,200},{3,203},{3,206},{3,209},
  {4,212},{4,216},{4,220},{4,224},{4,228},{4,232},{4,236},{4,240},
  {3,244},{3,247},{3,250},{3,253},{4,256},{4,260},{4,264},{4,268},
  {3,272},{3,275},{3,278},{3,281}};
static int palm_mvhei1[284] =
 {  0, 59, 19,  1, 62, 65, 10,  2,110,113, 74, 61,  3,158,161,122,
  109,  4,206,209,170,157,  5, 54,218,205,  6,254,257, 15,  7, 56,
  266,253,  8, 57, 17,  9, 58, 18, 49, 20, 39, 40, 66, 69, 30, 70,
   73,114,117, 31,118,121,162,165, 32,166,169,210,213, 33,214,217,
   25, 34, 45,258,261, 35,262,265, 27, 36, 47, 28, 37, 48, 29, 38,
   63, 60, 78, 81, 67, 64, 82, 85, 71, 68, 86, 89, 75, 72, 90, 77,
   79, 76, 94, 97, 83, 80, 98,101, 87, 84,102,105, 91, 88,106, 93,
   95, 92, 50, 99, 96, 21,103,100, 41,107,104, 11,111,108,126,129,
  115,112,130,133,119,116,134,137,123,120,138,125,127,124,142,145,
  131,128,146,149,135,132,150,153,139,136,154,141,143,140, 51,147,
  144, 22,151,148, 42,155,152, 12,159,156,174,177,163,160,178,181,
  167,164,182,185,171,168,186,173,175,172,190,193,179,176,194,197,
  183,180,198,201,187,184,202,189,191,188, 52,195,192, 23,199,196,
   43,203,200, 13,207,204,222,225,211,208,226,229,215,212,230,233,
  219,216,234,221,223,220,238,241,227,224,242,245,231,228,246,249,
  235,232,250,237,239,236, 53,243,240, 24,247,244, 44,251,248, 14,
  255,252,270,273,259,256,274,277,263,260,278,281,267,264,282,269,
  271,268, 55,275,272, 26,279,276, 46,283,280, 16};
static point3d palm_mvcp1[76] =
 {{0.876078,0.028790,-0.373245},{0.951057,0.780972,-0.269540},
  {0.485902,0.926264,-0.249508},{0.000000,0.981761,-0.241856},
  {-0.485902,0.926264,-0.249508},{-0.951057,0.780972,-0.269540},
  {-0.931916,0.367251,-0.326580},{-1.301347,0.045802,-0.370899},
  {-0.662243,-0.728428,-0.477645},{0.480356,-0.725703,-0.477269},
  {0.876078,0.045016,0.342904},{0.951057,0.800968,0.271698},
  {0.485902,0.946988,0.257944},{0.000000,1.002763,0.252690},
  {-0.485902,0.946988,0.257944},{-0.951057,0.800968,0.271698},
  {-0.931916,0.385174,0.310863},{-1.301347,0.062114,0.341293},
  {-0.662243,-0.715995,0.414587},{0.480356,-0.713257,0.414329},
  {1.015801,1.230474,-0.240000},{1.015801,1.230474,0.240000},
  {0.533228,1.301202,0.240000},{0.533228,1.301202,-0.240000},
  {1.030265,1.659116,-0.240000},{1.030265,1.659116,0.240000},
  {0.547692,1.729844,0.240000},{0.547692,1.729844,-0.240000},
  {1.023973,2.061068,-0.240000},{1.023973,2.061068,0.240000},
  {0.563575,2.222044,0.240000},{0.563575,2.222044,-0.240000},
  {0.475493,1.392233,-0.240000},{0.475493,1.392233,0.240000},
  {-0.012754,1.421463,0.240000},{-0.012754,1.421463,-0.240000},
  {0.462797,1.834215,-0.240000},{0.462797,1.834215,0.240000},
  {-0.025450,1.863446,0.240000},{-0.025450,1.863446,-0.240000},
  {0.450101,2.355702,-0.240000},{0.450101,2.355702,0.240000},
  {-0.038146,2.384932,0.240000},{-0.038146,2.384932,-0.240000},
  {-0.067161,1.529742,-0.240000},{-0.067161,1.529742,0.240000},
  {-0.553063,1.473720,0.240000},{-0.553063,1.473720,-0.240000},
  {-0.134321,2.024860,-0.240000},{-0.134321,2.024860,0.240000},
  {-0.620224,1.968838,0.240000},{-0.620224,1.968838,-0.240000},
  {-0.201482,2.547485,-0.240000},{-0.201482,2.547485,0.240000},
  {-0.687384,2.491464,0.240000},{-0.687384,2.491464,-0.240000},
  {-0.599522,1.447103,-0.240000},{-0.599522,1.447103,0.240000},
  {-1.064676,1.300436,0.240000},{-1.064676,1.300436,-0.240000},
  {-0.698940,1.912449,-0.240000},{-0.698940,1.912449,0.240000},
  {-1.164094,1.765783,0.240000},{-1.164094,1.765783,-0.240000},
  {-0.784155,2.392338,-0.240000},{-0.784155,2.392338,0.240000},
  {-1.249309,2.245671,0.240000},{-1.249309,2.245671,-0.240000},
  {-1.251696,0.840627,-0.240000},{-1.251696,0.840627,0.240000},
  {-1.711181,0.665568,0.240000},{-1.711181,0.665568,-0.240000},
  {-1.436328,1.451394,-0.240000},{-1.436328,1.451394,0.240000},
  {-1.895814,1.276335,0.240000},{-1.895814,1.276335,-0.240000}};
static BSMhalfedge palm_mhe1[284] =
 {{  0,  1,  0, 10},{  1,  2,  0, 61},{  2,  3,  0,109},{  3,  4,  0,157},
  {  4,  5,  0,205},{  5,  6,  0, 15},{  6,  7,  0,253},{  7,  8,  0, 17},
  {  8,  9,  0, 18},{  9,  0,  0, 19},{  1,  0,  2,  0},{ 31, 28,  3, 92},
  { 43, 40,  4,140},{ 55, 52,  5,188},{ 67, 64,  6,236},{  6,  5,  7,  5},
  { 75, 72,  8,268},{  8,  7,  9,  7},{  9,  8, 10,  8},{  0,  9, 11,  9},
  { 10, 11,  2, 30},{ 29, 30,  3,100},{ 41, 42,  4,148},{ 53, 54,  5,196},
  { 65, 66,  6,244},{ 15, 16,  7, 35},{ 73, 74,  8,276},{ 17, 18,  9, 37},
  { 18, 19, 10, 38},{ 19, 10, 11, 39},{ 11, 10,  1, 20},{ 12, 11,  1, 69},
  { 13, 12,  1,117},{ 14, 13,  1,165},{ 15, 14,  1,213},{ 16, 15,  1, 25},
  { 17, 16,  1,261},{ 18, 17,  1, 27},{ 19, 18,  1, 28},{ 10, 19,  1, 29},
  { 11,  1,  2, 65},{ 30, 31,  3,104},{ 42, 43,  4,152},{ 54, 55,  5,200},
  { 66, 67,  6,248},{ 16,  6,  7,257},{ 74, 75,  8,280},{ 18,  8,  9, 57},
  { 19,  9, 10, 58},{ 10,  0, 11, 59},{ 28, 29,  3, 96},{ 40, 41,  4,144},
  { 52, 53,  5,192},{ 64, 65,  6,240},{  5, 15,  7,217},{ 72, 73,  8,272},
  {  7, 17,  9,265},{  8, 18, 10, 47},{  9, 19, 11, 48},{  0, 10,  2, 49},
  { 20, 23, 12, 77},{  2,  1, 12,  1},{  1, 20, 12, 63},{ 20,  1, 13, 62},
  { 21, 20, 13, 81},{  1, 11, 13, 40},{ 11, 21, 13, 67},{ 21, 11, 14, 66},
  { 22, 21, 14, 85},{ 11, 12, 14, 31},{ 12, 22, 14, 71},{ 22, 12, 15, 70},
  { 23, 22, 15, 89},{ 12,  2, 15,113},{  2, 23, 15, 75},{ 23,  2, 12, 74},
  { 24, 27, 16, 93},{ 23, 20, 16, 60},{ 20, 24, 16, 79},{ 24, 20, 17, 78},
  { 25, 24, 17, 97},{ 20, 21, 17, 64},{ 21, 25, 17, 83},{ 25, 21, 18, 82},
  { 26, 25, 18,101},{ 21, 22, 18, 68},{ 22, 26, 18, 87},{ 26, 22, 19, 86},
  { 27, 26, 19,105},{ 22, 23, 19, 72},{ 23, 27, 19, 91},{ 27, 23, 16, 90},
  { 28, 31, 20, 11},{ 27, 24, 20, 76},{ 24, 28, 20, 95},{ 28, 24, 21, 94},
  { 29, 28, 21, 50},{ 24, 25, 21, 80},{ 25, 29, 21, 99},{ 29, 25, 22, 98},
  { 30, 29, 22, 21},{ 25, 26, 22, 84},{ 26, 30, 22,103},{ 30, 26, 23,102},
  { 31, 30, 23, 41},{ 26, 27, 23, 88},{ 27, 31, 23,107},{ 31, 27, 20,106},
  { 32, 35, 24,125},{  3,  2, 24,  2},{  2, 32, 24,111},{ 32,  2, 25,110},
  { 33, 32, 25,129},{  2, 12, 25, 73},{ 12, 33, 25,115},{ 33, 12, 26,114},
  { 34, 33, 26,133},{ 12, 13, 26, 32},{ 13, 34, 26,119},{ 34, 13, 27,118},
  { 35, 34, 27,137},{ 13,  3, 27,161},{  3, 35, 27,123},{ 35,  3, 24,122},
  { 36, 39, 28,141},{ 35, 32, 28,108},{ 32, 36, 28,127},{ 36, 32, 29,126},
  { 37, 36, 29,145},{ 32, 33, 29,112},{ 33, 37, 29,131},{ 37, 33, 30,130},
  { 38, 37, 30,149},{ 33, 34, 30,116},{ 34, 38, 30,135},{ 38, 34, 31,134},
  { 39, 38, 31,153},{ 34, 35, 31,120},{ 35, 39, 31,139},{ 39, 35, 28,138},
  { 40, 43, 32, 12},{ 39, 36, 32,124},{ 36, 40, 32,143},{ 40, 36, 33,142},
  { 41, 40, 33, 51},{ 36, 37, 33,128},{ 37, 41, 33,147},{ 41, 37, 34,146},
  { 42, 41, 34, 22},{ 37, 38, 34,132},{ 38, 42, 34,151},{ 42, 38, 35,150},
  { 43, 42, 35, 42},{ 38, 39, 35,136},{ 39, 43, 35,155},{ 43, 39, 32,154},
  { 44, 47, 36,173},{  4,  3, 36,  3},{  3, 44, 36,159},{ 44,  3, 37,158},
  { 45, 44, 37,177},{  3, 13, 37,121},{ 13, 45, 37,163},{ 45, 13, 38,162},
  { 46, 45, 38,181},{ 13, 14, 38, 33},{ 14, 46, 38,167},{ 46, 14, 39,166},
  { 47, 46, 39,185},{ 14,  4, 39,209},{  4, 47, 39,171},{ 47,  4, 36,170},
  { 48, 51, 40,189},{ 47, 44, 40,156},{ 44, 48, 40,175},{ 48, 44, 41,174},
  { 49, 48, 41,193},{ 44, 45, 41,160},{ 45, 49, 41,179},{ 49, 45, 42,178},
  { 50, 49, 42,197},{ 45, 46, 42,164},{ 46, 50, 42,183},{ 50, 46, 43,182},
  { 51, 50, 43,201},{ 46, 47, 43,168},{ 47, 51, 43,187},{ 51, 47, 40,186},
  { 52, 55, 44, 13},{ 51, 48, 44,172},{ 48, 52, 44,191},{ 52, 48, 45,190},
  { 53, 52, 45, 52},{ 48, 49, 45,176},{ 49, 53, 45,195},{ 53, 49, 46,194},
  { 54, 53, 46, 23},{ 49, 50, 46,180},{ 50, 54, 46,199},{ 54, 50, 47,198},
  { 55, 54, 47, 43},{ 50, 51, 47,184},{ 51, 55, 47,203},{ 55, 51, 44,202},
  { 56, 59, 48,221},{  5,  4, 48,  4},{  4, 56, 48,207},{ 56,  4, 49,206},
  { 57, 56, 49,225},{  4, 14, 49,169},{ 14, 57, 49,211},{ 57, 14, 50,210},
  { 58, 57, 50,229},{ 14, 15, 50, 34},{ 15, 58, 50,215},{ 58, 15, 51,214},
  { 59, 58, 51,233},{ 15,  5, 51, 54},{  5, 59, 51,219},{ 59,  5, 48,218},
  { 60, 63, 52,237},{ 59, 56, 52,204},{ 56, 60, 52,223},{ 60, 56, 53,222},
  { 61, 60, 53,241},{ 56, 57, 53,208},{ 57, 61, 53,227},{ 61, 57, 54,226},
  { 62, 61, 54,245},{ 57, 58, 54,212},{ 58, 62, 54,231},{ 62, 58, 55,230},
  { 63, 62, 55,249},{ 58, 59, 55,216},{ 59, 63, 55,235},{ 63, 59, 52,234},
  { 64, 67, 56, 14},{ 63, 60, 56,220},{ 60, 64, 56,239},{ 64, 60, 57,238},
  { 65, 64, 57, 53},{ 60, 61, 57,224},{ 61, 65, 57,243},{ 65, 61, 58,242},
  { 66, 65, 58, 24},{ 61, 62, 58,228},{ 62, 66, 58,247},{ 66, 62, 59,246},
  { 67, 66, 59, 44},{ 62, 63, 59,232},{ 63, 67, 59,251},{ 67, 63, 56,250},
  { 68, 71, 60,269},{  7,  6, 60,  6},{  6, 68, 60,255},{ 68,  6, 61,254},
  { 69, 68, 61,273},{  6, 16, 61, 45},{ 16, 69, 61,259},{ 69, 16, 62,258},
  { 70, 69, 62,277},{ 16, 17, 62, 36},{ 17, 70, 62,263},{ 70, 17, 63,262},
  { 71, 70, 63,281},{ 17,  7, 63, 56},{  7, 71, 63,267},{ 71,  7, 60,266},
  { 72, 75, 64, 16},{ 71, 68, 64,252},{ 68, 72, 64,271},{ 72, 68, 65,270},
  { 73, 72, 65, 55},{ 68, 69, 65,256},{ 69, 73, 65,275},{ 73, 69, 66,274},
  { 74, 73, 66, 26},{ 69, 70, 66,260},{ 70, 74, 66,279},{ 74, 70, 67,278},
  { 75, 74, 67, 46},{ 70, 71, 67,264},{ 71, 75, 67,283},{ 75, 71, 64,282}};
static BSMfacet palm_mfac1[68] =
 {{10,  0},{10, 10},{ 4, 20},{ 4, 24},{ 4, 28},{ 4, 32},{ 4, 36},{ 4, 40},
  { 4, 44},{ 4, 48},{ 4, 52},{ 4, 56},{ 4, 60},{ 4, 64},{ 4, 68},{ 4, 72},
  { 4, 76},{ 4, 80},{ 4, 84},{ 4, 88},{ 4, 92},{ 4, 96},{ 4,100},{ 4,104},
  { 4,108},{ 4,112},{ 4,116},{ 4,120},{ 4,124},{ 4,128},{ 4,132},{ 4,136},
  { 4,140},{ 4,144},{ 4,148},{ 4,152},{ 4,156},{ 4,160},{ 4,164},{ 4,168},
  { 4,172},{ 4,176},{ 4,180},{ 4,184},{ 4,188},{ 4,192},{ 4,196},{ 4,200},
  { 4,204},{ 4,208},{ 4,212},{ 4,216},{ 4,220},{ 4,224},{ 4,228},{ 4,232},
  { 4,236},{ 4,240},{ 4,244},{ 4,248},{ 4,252},{ 4,256},{ 4,260},{ 4,264},
  { 4,268},{ 4,272},{ 4,276},{ 4,280}};
static int palm_mfhei1[284] =
 {  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 39, 38, 37, 36, 35, 34,
   33, 32, 31, 30, 10, 59, 20, 40, 11, 50, 21, 41, 12, 51, 22, 42,
   13, 52, 23, 43, 14, 53, 24, 44, 15, 54, 25, 45, 16, 55, 26, 46,
   17, 56, 27, 47, 18, 57, 28, 48, 19, 58, 29, 49, 60, 75, 61, 62,
   64, 63, 65, 66, 68, 67, 69, 70, 72, 71, 73, 74, 76, 91, 77, 78,
   80, 79, 81, 82, 84, 83, 85, 86, 88, 87, 89, 90, 92,107, 93, 94,
   96, 95, 97, 98,100, 99,101,102,104,103,105,106,108,123,109,110,
  112,111,113,114,116,115,117,118,120,119,121,122,124,139,125,126,
  128,127,129,130,132,131,133,134,136,135,137,138,140,155,141,142,
  144,143,145,146,148,147,149,150,152,151,153,154,156,171,157,158,
  160,159,161,162,164,163,165,166,168,167,169,170,172,187,173,174,
  176,175,177,178,180,179,181,182,184,183,185,186,188,203,189,190,
  192,191,193,194,196,195,197,198,200,199,201,202,204,219,205,206,
  208,207,209,210,212,211,213,214,216,215,217,218,220,235,221,222,
  224,223,225,226,228,227,229,230,232,231,233,234,236,251,237,238,
  240,239,241,242,244,243,245,246,248,247,249,250,252,267,253,254,
  256,255,257,258,260,259,261,262,264,263,265,266,268,283,269,270,
  272,271,273,274,276,275,277,278,280,279,281,282};

/* ////////////////////////////////////////////////////////////////////////// */
/* foot surface mesh */
static int foot_nv1 = 60;
static int foot_nhe1 = 220;
static int foot_nfac1 = 52;
static BSMvertex foot_mv1[60] =
 {{3,  0},{4,  3},{4,  7},{4, 11},{5, 15},{5, 20},{5, 25},{4, 30},
  {3, 34},{3, 37},{3, 40},{4, 43},{4, 47},{4, 51},{5, 55},{5, 60},
  {5, 65},{4, 70},{3, 74},{3, 77},{4, 80},{4, 84},{4, 88},{4, 92},
  {4, 96},{4,100},{4,104},{4,108},{4,112},{4,116},{4,120},{4,124},
  {4,128},{4,132},{4,136},{4,140},{3,144},{3,147},{3,150},{3,153},
  {4,156},{4,160},{4,164},{4,168},{3,172},{3,175},{3,178},{3,181},
  {3,184},{3,187},{3,190},{3,193},{3,196},{3,199},{3,202},{3,205},
  {3,208},{3,211},{3,214},{3,217}};
static int foot_mvhei1[220] =
 {  0, 59, 19,  1, 62, 65, 10,  2, 51, 74, 61,  3, 78, 81, 12,  4,
   94, 97, 90, 77,  5,110,113,106, 93,  6,142,145,122,109,  7, 56,
  154,141,  8, 57, 17,  9, 58, 18, 49, 20, 39, 40, 66, 69, 30, 70,
   73, 22, 31, 42, 82, 85, 32, 86, 89, 98,101, 33,102,105,114,117,
   34,118,121,146,149, 35,150,153, 27, 36, 47, 28, 37, 48, 29, 38,
   63, 60,158,161, 67, 64,162,165, 71, 68,166,169, 75, 72,170,157,
   79, 76,174,177, 83, 80,178,181, 87, 84,182,185, 91, 88,186,173,
   95, 92,190,193, 99, 96,194,197,103,100,198,201,107,104,202,189,
  111,108,126,129,115,112,130,133,119,116,134,137,123,120,138,125,
  127,124, 54,131,128, 25,135,132, 45,139,136, 15,143,140,206,209,
  147,144,210,213,151,148,214,217,155,152,218,205,159,156, 50,163,
  160, 21,167,164, 41,171,168, 11,175,172, 52,179,176, 23,183,180,
   43,187,184, 13,191,188, 53,195,192, 24,199,196, 44,203,200, 14,
  207,204, 55,211,208, 26,215,212, 46,219,216, 16};
static point3d foot_mvcp1[60] =
 {{0.305389,-1.013697,-0.701343},{0.671024,0.229108,0.060819},
  {0.462373,0.512053,-0.233333},{0.406310,0.732055,-0.233333},
  {0.156320,0.847211,-0.233333},{-0.152695,0.847963,-0.233333},
  {-0.393914,0.772273,-0.233333},{-0.571041,0.678243,-0.233333},
  {-0.407306,-0.066144,-0.351160},{-0.265748,-1.048029,-0.653279},
  {0.391358,-0.952228,0.967973},{0.671024,0.235832,0.233333},
  {0.462373,0.512053,0.233333},{0.406310,0.730543,0.206746},
  {0.156320,0.844970,0.193808},{-0.152695,0.845717,0.193723},
  {-0.393914,0.770506,0.202227},{-0.571041,0.677072,0.212792},
  {-0.360414,-0.279001,0.658190},{-0.226672,-0.949872,0.967973},
  {0.883928,0.655678,-0.233333},{0.883928,0.654650,0.215327},
  {0.516391,0.822484,0.196350},{0.516391,0.824582,-0.233333},
  {0.467737,1.146042,-0.233333},{0.467737,1.141908,0.160232},
  {0.214579,1.161797,0.157983},{0.214579,1.166057,-0.233333},
  {0.125891,1.192369,-0.233333},{0.125891,1.187942,0.155027},
  {-0.135472,1.188689,0.154943},{-0.135472,1.193120,-0.233333},
  {-0.182256,1.122151,-0.233333},{-0.189322,1.112981,0.163503},
  {-0.398907,1.042685,0.171451},{-0.403768,1.040791,-0.233333},
  {-0.220367,1.256855,-0.233333},{-0.227151,1.250351,0.147970},
  {-0.401588,1.175951,0.156383},{-0.396309,1.190970,-0.233333},
  {-0.455930,0.966951,-0.233333},{-0.455930,0.963951,0.180354},
  {-0.601259,0.894214,0.188239},{-0.601259,0.896769,-0.233333},
  {0.874958,0.969073,-0.233333},{0.874958,0.966060,0.180116},
  {0.631500,1.092164,0.165857},{0.631500,1.095981,-0.233333},
  {0.477044,1.339383,-0.233333},{0.477044,1.334025,0.138509},
  {0.223885,1.353914,0.136260},{0.223885,1.359398,-0.233333},
  {0.124415,1.368493,-0.233333},{0.124415,1.362951,0.135238},
  {-0.136948,1.363698,0.135154},{-0.136948,1.369245,-0.233333},
  {-0.464306,1.065483,-0.233333},{-0.464306,1.061859,0.169283},
  {-0.609634,0.992122,0.177169},{-0.609634,0.995301,-0.233333}};
static BSMhalfedge foot_mhe1[220] =
 {{  0,  1,  0, 10},{  1,  2,  0, 61},{  2,  3,  0, 12},{  3,  4,  0, 77},
  {  4,  5,  0, 93},{  5,  6,  0,109},{  6,  7,  0,141},{  7,  8,  0, 17},
  {  8,  9,  0, 18},{  9,  0,  0, 19},{  1,  0,  2,  0},{ 47, 44,  3,156},
  {  3,  2,  4,  2},{ 51, 48,  5,172},{ 55, 52,  6,188},{ 39, 36,  7,124},
  { 59, 56,  8,204},{  8,  7,  9,  7},{  9,  8, 10,  8},{  0,  9, 11,  9},
  { 10, 11,  2, 30},{ 45, 46,  3,164},{ 12, 13,  4, 32},{ 49, 50,  5,180},
  { 53, 54,  6,196},{ 37, 38,  7,132},{ 57, 58,  8,212},{ 17, 18,  9, 37},
  { 18, 19, 10, 38},{ 19, 10, 11, 39},{ 11, 10,  1, 20},{ 12, 11,  1, 69},
  { 13, 12,  1, 22},{ 14, 13,  1, 85},{ 15, 14,  1,101},{ 16, 15,  1,117},
  { 17, 16,  1,149},{ 18, 17,  1, 27},{ 19, 18,  1, 28},{ 10, 19,  1, 29},
  { 11,  1,  2, 65},{ 46, 47,  3,168},{ 13,  3,  4, 81},{ 50, 51,  5,184},
  { 54, 55,  6,200},{ 38, 39,  7,136},{ 58, 59,  8,216},{ 18,  8,  9, 57},
  { 19,  9, 10, 58},{ 10,  0, 11, 59},{ 44, 45,  3,160},{  2, 12,  4, 73},
  { 48, 49,  5,176},{ 52, 53,  6,192},{ 36, 37,  7,128},{ 56, 57,  8,208},
  {  7, 17,  9,153},{  8, 18, 10, 47},{  9, 19, 11, 48},{  0, 10,  2, 49},
  { 20, 23, 12,157},{  2,  1, 12,  1},{  1, 20, 12, 63},{ 20,  1, 13, 62},
  { 21, 20, 13,161},{  1, 11, 13, 40},{ 11, 21, 13, 67},{ 21, 11, 14, 66},
  { 22, 21, 14,165},{ 11, 12, 14, 31},{ 12, 22, 14, 71},{ 22, 12, 15, 70},
  { 23, 22, 15,169},{ 12,  2, 15, 51},{  2, 23, 15, 75},{ 23,  2, 12, 74},
  { 24, 27, 16,173},{  4,  3, 16,  3},{  3, 24, 16, 79},{ 24,  3, 17, 78},
  { 25, 24, 17,177},{  3, 13, 17, 42},{ 13, 25, 17, 83},{ 25, 13, 18, 82},
  { 26, 25, 18,181},{ 13, 14, 18, 33},{ 14, 26, 18, 87},{ 26, 14, 19, 86},
  { 27, 26, 19,185},{ 14,  4, 19, 97},{  4, 27, 19, 91},{ 27,  4, 16, 90},
  { 28, 31, 20,189},{  5,  4, 20,  4},{  4, 28, 20, 95},{ 28,  4, 21, 94},
  { 29, 28, 21,193},{  4, 14, 21, 89},{ 14, 29, 21, 99},{ 29, 14, 22, 98},
  { 30, 29, 22,197},{ 14, 15, 22, 34},{ 15, 30, 22,103},{ 30, 15, 23,102},
  { 31, 30, 23,201},{ 15,  5, 23,113},{  5, 31, 23,107},{ 31,  5, 20,106},
  { 32, 35, 24,125},{  6,  5, 24,  5},{  5, 32, 24,111},{ 32,  5, 25,110},
  { 33, 32, 25,129},{  5, 15, 25,105},{ 15, 33, 25,115},{ 33, 15, 26,114},
  { 34, 33, 26,133},{ 15, 16, 26, 35},{ 16, 34, 26,119},{ 34, 16, 27,118},
  { 35, 34, 27,137},{ 16,  6, 27,145},{  6, 35, 27,123},{ 35,  6, 24,122},
  { 36, 39, 28, 15},{ 35, 32, 28,108},{ 32, 36, 28,127},{ 36, 32, 29,126},
  { 37, 36, 29, 54},{ 32, 33, 29,112},{ 33, 37, 29,131},{ 37, 33, 30,130},
  { 38, 37, 30, 25},{ 33, 34, 30,116},{ 34, 38, 30,135},{ 38, 34, 31,134},
  { 39, 38, 31, 45},{ 34, 35, 31,120},{ 35, 39, 31,139},{ 39, 35, 28,138},
  { 40, 43, 32,205},{  7,  6, 32,  6},{  6, 40, 32,143},{ 40,  6, 33,142},
  { 41, 40, 33,209},{  6, 16, 33,121},{ 16, 41, 33,147},{ 41, 16, 34,146},
  { 42, 41, 34,213},{ 16, 17, 34, 36},{ 17, 42, 34,151},{ 42, 17, 35,150},
  { 43, 42, 35,217},{ 17,  7, 35, 56},{  7, 43, 35,155},{ 43,  7, 32,154},
  { 44, 47, 36, 11},{ 23, 20, 36, 60},{ 20, 44, 36,159},{ 44, 20, 37,158},
  { 45, 44, 37, 50},{ 20, 21, 37, 64},{ 21, 45, 37,163},{ 45, 21, 38,162},
  { 46, 45, 38, 21},{ 21, 22, 38, 68},{ 22, 46, 38,167},{ 46, 22, 39,166},
  { 47, 46, 39, 41},{ 22, 23, 39, 72},{ 23, 47, 39,171},{ 47, 23, 36,170},
  { 48, 51, 40, 13},{ 27, 24, 40, 76},{ 24, 48, 40,175},{ 48, 24, 41,174},
  { 49, 48, 41, 52},{ 24, 25, 41, 80},{ 25, 49, 41,179},{ 49, 25, 42,178},
  { 50, 49, 42, 23},{ 25, 26, 42, 84},{ 26, 50, 42,183},{ 50, 26, 43,182},
  { 51, 50, 43, 43},{ 26, 27, 43, 88},{ 27, 51, 43,187},{ 51, 27, 40,186},
  { 52, 55, 44, 14},{ 31, 28, 44, 92},{ 28, 52, 44,191},{ 52, 28, 45,190},
  { 53, 52, 45, 53},{ 28, 29, 45, 96},{ 29, 53, 45,195},{ 53, 29, 46,194},
  { 54, 53, 46, 24},{ 29, 30, 46,100},{ 30, 54, 46,199},{ 54, 30, 47,198},
  { 55, 54, 47, 44},{ 30, 31, 47,104},{ 31, 55, 47,203},{ 55, 31, 44,202},
  { 56, 59, 48, 16},{ 43, 40, 48,140},{ 40, 56, 48,207},{ 56, 40, 49,206},
  { 57, 56, 49, 55},{ 40, 41, 49,144},{ 41, 57, 49,211},{ 57, 41, 50,210},
  { 58, 57, 50, 26},{ 41, 42, 50,148},{ 42, 58, 50,215},{ 58, 42, 51,214},
  { 59, 58, 51, 46},{ 42, 43, 51,152},{ 43, 59, 51,219},{ 59, 43, 48,218}};
static BSMfacet foot_mfac1[52] =
 {{10,  0},{10, 10},{ 4, 20},{ 4, 24},{ 4, 28},{ 4, 32},{ 4, 36},{ 4, 40},
  { 4, 44},{ 4, 48},{ 4, 52},{ 4, 56},{ 4, 60},{ 4, 64},{ 4, 68},{ 4, 72},
  { 4, 76},{ 4, 80},{ 4, 84},{ 4, 88},{ 4, 92},{ 4, 96},{ 4,100},{ 4,104},
  { 4,108},{ 4,112},{ 4,116},{ 4,120},{ 4,124},{ 4,128},{ 4,132},{ 4,136},
  { 4,140},{ 4,144},{ 4,148},{ 4,152},{ 4,156},{ 4,160},{ 4,164},{ 4,168},
  { 4,172},{ 4,176},{ 4,180},{ 4,184},{ 4,188},{ 4,192},{ 4,196},{ 4,200},
  { 4,204},{ 4,208},{ 4,212},{ 4,216}};
static int foot_mfhei1[220] =
 {  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 39, 38, 37, 36, 35, 34,
   33, 32, 31, 30, 10, 59, 20, 40, 11, 50, 21, 41, 12, 51, 22, 42,
   13, 52, 23, 43, 14, 53, 24, 44, 15, 54, 25, 45, 16, 55, 26, 46,
   17, 56, 27, 47, 18, 57, 28, 48, 19, 58, 29, 49, 60, 75, 61, 62,
   64, 63, 65, 66, 68, 67, 69, 70, 72, 71, 73, 74, 76, 91, 77, 78,
   80, 79, 81, 82, 84, 83, 85, 86, 88, 87, 89, 90, 92,107, 93, 94,
   96, 95, 97, 98,100, 99,101,102,104,103,105,106,108,123,109,110,
  112,111,113,114,116,115,117,118,120,119,121,122,124,139,125,126,
  128,127,129,130,132,131,133,134,136,135,137,138,140,155,141,142,
  144,143,145,146,148,147,149,150,152,151,153,154,156,171,157,158,
  160,159,161,162,164,163,165,166,168,167,169,170,172,187,173,174,
  176,175,177,178,180,179,181,182,184,183,185,186,188,203,189,190,
  192,191,193,194,196,195,197,198,200,199,201,202,204,219,205,206,
  208,207,209,210,212,211,213,214,216,215,217,218};

/* ////////////////////////////////////////////////////////////////////////// */
static void DrawIt ( int nv, BSMvertex *mv, int *mvhei, point3d *mvc,
                     int nhe, BSMhalfedge *mhe,
                     int nfac, BSMfacet *mfac, int *mfhei,
#ifdef NORMAL_SHADING
                     vector3d *mvn
#else
                     vector3d *mfn
#endif
                   )
{
  int i, j, k, fhe, deg;
  GLfloat specular[] = {0.9,0.8,0.6,1.0};

  glPushMatrix ();
  glScaled ( 0.26, 0.26, 0.26 );
  glRotated ( -90.0, 0.0, 0.0, 1.0 );
  glRotated ( 90.0, 1.0, 0.0, 0.0 );
  glMaterialfv ( GL_FRONT_AND_BACK, GL_SPECULAR, specular );
  glMaterialf ( GL_FRONT_AND_BACK, GL_SHININESS, 1.0 );
  glColor3d ( 0.94, 0.6, 0.6 );
#ifdef NORMAL_SHADING
  for ( i = 0; i < nfac; i++ ) {
    glBegin ( GL_POLYGON );
    fhe = mfac[i].firsthalfedge;
    deg = mfac[i].degree;
    for ( j = 0; j < deg; j++ ) {
      k = mhe[mfhei[fhe+j]].v0;
      glNormal3dv ( &mvn[k].x );
      glVertex3dv ( &mvc[k].x );
    }
    glEnd ();
  }
#else
  for ( i = 0; i < nfac; i++ ) {
    glBegin ( GL_POLYGON );
    glNormal3dv ( &mfn[i].x );
    fhe = mfac[i].firsthalfedge;
    deg = mfac[i].degree;
    for ( j = 0; j < deg; j++ ) {
      k = mhe[mfhei[fhe+j]].v0;
      glVertex3dv ( &mvc[k].x );
    }
    glEnd ();
  }
#endif
  glPopMatrix ();
} /*DrawIt*/

static void MakeMeshList ( GLint dlist,
                           int nv, BSMvertex *mv, int *mvhei, point3d *mvc,
                           int nhe, BSMhalfedge *mhe,
                           int nfac, BSMfacet *mfac, int *mfhei )
{
  void     *sp;
  vector3d *mfn, w1, w2;
  int      j, fhe, v0, v1, v2;
#ifdef NORMAL_SHADING
  vector3d *mvn;
  int      i, deg;
#endif

  sp = pkv_GetScratchMemTop ();
  mfn = pkv_GetScratchMem ( nfac*sizeof(vector3d) );
  if ( !mfn )
    return;
#ifdef NORMAL_SHADING
  mvn = pkv_GetScratchMem ( nv*sizeof(vector3d) );
  if ( !mvn )
    return;
#endif
  for ( j = 0; j < nfac; j++ ) {
    fhe = mfac[j].firsthalfedge;
    v0 = mhe[mfhei[fhe]].v0;
    v1 = mhe[mfhei[fhe]].v1;
    v2 = mhe[mfhei[fhe+1]].v1;
    SubtractPoints3d ( &mvc[v1], &mvc[v0], &w1 );
    SubtractPoints3d ( &mvc[v2], &mvc[v1], &w2 );
    CrossProduct3d ( &w2, &w1, &mfn[j] );
    NormalizeVector3d ( &mfn[j] );
  }
#ifdef NORMAL_SHADING
  for ( i = 0; i < nv; i++ ) {
    fhe = mv[i].firsthalfedge;
    deg = mv[i].degree;
    mvn[i] = mfn[mhe[mvhei[fhe]].facetnum];
    for ( j = 1; j < deg; j++ )
      AddVector3d ( &mvn[i], &mfn[mhe[mvhei[fhe+j]].facetnum], &mvn[i] );
    NormalizeVector3d ( &mvn[i] );
  }
#endif
  glNewList ( dlist, GL_COMPILE );
  DrawIt ( nv, mv, mvhei, mvc, nhe, mhe, nfac, mfac, mfhei,
#ifdef NORMAL_SHADING
           mvn
#else
           mfn
#endif
         );
  glEndList ();
  pkv_SetScratchMemTop ( sp );
} /*MakeMeshList*/

/* ////////////////////////////////////////////////////////////////////////// */
void InitPalm ( void )
{
  int         nv2, nhe2, nfac2, nv3, nhe3, nfac3;
  BSMvertex   *mv2, *mv3;
  BSMhalfedge *mhe2, *mhe3;
  BSMfacet    *mfac2, *mfac3;
  point3d     *mvcp2, *mvcp3;
  int         *mvhei2, *mfhei2, *mvhei3, *mfhei3;

  palm_dlist = glGenLists ( 3 );
  if ( !palm_dlist ) {
    printf ( "Could not generate the display list.\n" );
    exit ( 1 );
  }
  MakeMeshList ( palm_dlist, palm_nv1, palm_mv1, palm_mvhei1, palm_mvcp1,
                 palm_nhe1, palm_mhe1, palm_nfac1, palm_mfac1, palm_mfhei1 );
  if ( !bsm_RefineBSMeshd ( 3, 3, palm_nv1, palm_mv1, palm_mvhei1, (double*)palm_mvcp1,
                           palm_nhe1, palm_mhe1, palm_nfac1, palm_mfac1, palm_mfhei1,
                           &nv2, &mv2, &mvhei2, (double**)&mvcp2,
                           &nhe2, &mhe2, &nfac2, &mfac2, &mfhei2 ) )
    return;
  MakeMeshList ( palm_dlist+1, nv2, mv2, mvhei2, mvcp2,
                 nhe2, mhe2, nfac2, mfac2, mfhei2 );
  if ( !bsm_RefineBSMeshd ( 3, 3, nv2, mv2, mvhei2, (double*)mvcp2,
                           nhe2, mhe2, nfac2, mfac2, mfhei2,
                           &nv3, &mv3, &mvhei3, (double**)&mvcp3,
                           &nhe3, &mhe3, &nfac3, &mfac3, &mfhei3 ) )
    return;
  MakeMeshList ( palm_dlist+2, nv3, mv3, mvhei3, mvcp3,
                 nhe3, mhe3, nfac3, mfac3, mfhei3 );

  PKV_FREE ( mv2 );
  PKV_FREE ( mvhei2 );
  PKV_FREE ( mvcp2 );
  PKV_FREE ( mhe2 );
  PKV_FREE ( mfac2 );
  PKV_FREE ( mfhei2 );
  PKV_FREE ( mv3 );
  PKV_FREE ( mvhei3 );
  PKV_FREE ( mvcp3 );
  PKV_FREE ( mhe3 );
  PKV_FREE ( mfac3 );
  PKV_FREE ( mfhei3 );
} /*InitPalm*/

void DrawLeftPalm ( void )
{
  glMaterialf ( GL_FRONT_AND_BACK, GL_SHININESS, 100.0 );
  glCallList ( palm_dlist+palm_lod-1 );
} /*DrawLeftPalm*/

void DrawRightPalm ( void )
{
  glPushMatrix ();
  glScalef ( -1.0, 1.0, 1.0 );
  glMaterialf ( GL_FRONT_AND_BACK, GL_SHININESS, 100.0 );
  glCallList ( palm_dlist+palm_lod-1 );
  glPopMatrix ();
} /*DrawRightPalm*/

/* ////////////////////////////////////////////////////////////////////////// */
void InitFoot ( void )
{
/*
#define MAXNV   1000
#define MAXNHE  4000
#define MAXNFAC 1000
  int         degree, spdimen;
  boolean     rational;
  BSMvertex   mv[MAXNV];
  int         mvhei[MAXNHE];
  BSMhalfedge mhe[MAXNHE];
  BSMfacet    mfac[MAXNFAC];
  int         mfhei[MAXNFAC];
  point4d     vc[MAXNV];
  point3d     mvcp[MAXNV];
  byte        mkv[MAXNV];
  char        name[50];
  int         nv, nhe, nfac;
  int         i;

  if ( bsf_OpenInputFile ( "stopa.bs" ) ) {
    if ( bsf_ReadBSMesh4d ( MAXNV, MAXNHE, MAXNFAC, &degree,
         &nv, mv, mvhei, vc, &nhe, mhe, &nfac, mfac, mfhei,
         &spdimen, &rational, mkv, name ) ) {

      bsf_CloseInputFile ();
      for ( i = 0; i < nv; i++ )
        Point4to3d ( &vc[i], &mvcp[i] );
      if ( !foot_dlist )
        foot_dlist = glGenLists ( 3 );
      MakeMeshList ( foot_dlist, nv, mv, mvhei, mvcp,
                     nhe, mhe, nfac, mfac, mfhei );

    }
    else
      exit ( 1 );
  }
  else
    exit ( 1 );
*/
  int         nv2, nhe2, nfac2, nv3, nhe3, nfac3;
  BSMvertex   *mv2, *mv3;
  BSMhalfedge *mhe2, *mhe3;
  BSMfacet    *mfac2, *mfac3;
  point3d     *mvcp2, *mvcp3;
  int         *mvhei2, *mfhei2, *mvhei3, *mfhei3;

  foot_dlist = glGenLists ( 3 );
  if ( !foot_dlist ) {
    printf ( "Could not generate the display list.\n" );
    exit ( 1 );
  }
  MakeMeshList ( foot_dlist, foot_nv1, foot_mv1, foot_mvhei1, foot_mvcp1,
                 foot_nhe1, foot_mhe1, foot_nfac1, foot_mfac1, foot_mfhei1 );
  if ( !bsm_RefineBSMeshd ( 3, 3, foot_nv1, foot_mv1, foot_mvhei1, (double*)foot_mvcp1,
                           foot_nhe1, foot_mhe1, foot_nfac1, foot_mfac1, foot_mfhei1,
                           &nv2, &mv2, &mvhei2, (double**)&mvcp2,
                           &nhe2, &mhe2, &nfac2, &mfac2, &mfhei2 ) )
    return;
  MakeMeshList ( foot_dlist+1, nv2, mv2, mvhei2, mvcp2,
                 nhe2, mhe2, nfac2, mfac2, mfhei2 );
  if ( !bsm_RefineBSMeshd ( 3, 3, nv2, mv2, mvhei2, (double*)mvcp2,
                           nhe2, mhe2, nfac2, mfac2, mfhei2,
                           &nv3, &mv3, &mvhei3, (double**)&mvcp3,
                           &nhe3, &mhe3, &nfac3, &mfac3, &mfhei3 ) )
    return;
  MakeMeshList ( foot_dlist+2, nv3, mv3, mvhei3, mvcp3,
                 nhe3, mhe3, nfac3, mfac3, mfhei3 );

  PKV_FREE ( mv2 );
  PKV_FREE ( mvhei2 );
  PKV_FREE ( mvcp2 );
  PKV_FREE ( mhe2 );
  PKV_FREE ( mfac2 );
  PKV_FREE ( mfhei2 );
  PKV_FREE ( mv3 );
  PKV_FREE ( mvhei3 );
  PKV_FREE ( mvcp3 );
  PKV_FREE ( mhe3 );
  PKV_FREE ( mfac3 );
  PKV_FREE ( mfhei3 );
} /*InitFoot*/

void DrawLeftFoot ( void )
{
  glScaled ( 1.3, 1.75, 1.3 );
  glTranslated ( 0.0, 0.15, 0.0 );
  glRotated ( -90.0, 0.0, 1.0, 0.0 );
  glRotated ( -90.0, 1.0, 0.0, 0.0 );
  glMaterialf ( GL_FRONT_AND_BACK, GL_SHININESS, 100.0 );
  glCallList ( foot_dlist+palm_lod-1 );
} /*DrawLeftFoot*/

void DrawRightFoot ( void )
{
  glScaled ( -1.0, 1.0, 1.0 );
  DrawLeftFoot ();
} /*DrawRightFoot*/

